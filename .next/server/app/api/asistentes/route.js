"use strict";(()=>{var e={};e.id=731,e.ids=[731],e.modules={20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},27790:e=>{e.exports=require("assert")},78893:e=>{e.exports=require("buffer")},61282:e=>{e.exports=require("child_process")},84770:e=>{e.exports=require("crypto")},17702:e=>{e.exports=require("events")},92048:e=>{e.exports=require("fs")},32615:e=>{e.exports=require("http")},35240:e=>{e.exports=require("https")},98216:e=>{e.exports=require("net")},19801:e=>{e.exports=require("os")},55315:e=>{e.exports=require("path")},68621:e=>{e.exports=require("punycode")},86624:e=>{e.exports=require("querystring")},76162:e=>{e.exports=require("stream")},82452:e=>{e.exports=require("tls")},74175:e=>{e.exports=require("tty")},17360:e=>{e.exports=require("url")},21764:e=>{e.exports=require("util")},71568:e=>{e.exports=require("zlib")},15673:e=>{e.exports=require("node:events")},97742:e=>{e.exports=require("node:process")},47261:e=>{e.exports=require("node:util")},50632:(e,s,t)=>{t.r(s),t.d(s,{originalPathname:()=>I,patchFetch:()=>f,requestAsyncStorage:()=>E,routeModule:()=>g,serverHooks:()=>A,staticGenerationAsyncStorage:()=>m});var r={};t.r(r),t.d(r,{GET:()=>c,POST:()=>l});var a=t(49303),i=t(88716),n=t(60670),o=t(87070),d=t(56573),p=t(38990),h=t(15526);async function u(e){try{h.Z.isConfigured()?(await h.Z.addAsistente(e),console.log("Asistente sincronizado con Google Sheets:",e.nombre)):console.log("Google Sheets no configurado, solo guardando en memoria")}catch(e){console.error("Error sincronizando con Google Sheets:",e)}}async function c(){try{if(h.Z.isConfigured())try{let e=p.Z.getAsistentes(),s=await h.Z.syncWithMemoryDatabase(e);return s.forEach(e=>{p.Z.findAsistenteById(e.id)?p.Z.updateAsistente(e.id,e):p.Z.addAsistente(e)}),o.NextResponse.json(s)}catch(e){console.error("Error sincronizando con Google Sheets:",e)}let e=p.Z.getAsistentes();return o.NextResponse.json(e)}catch(e){return o.NextResponse.json({error:"Error obteniendo asistentes"},{status:500})}}async function l(e){try{let s=await e.json(),t={id:(0,d.Z)(),nombre:s.nombre,email:s.email||"",cargo:s.cargo||"",empresa:s.empresa||"",presente:!1,escarapelaImpresa:!1,fechaRegistro:new Date().toISOString(),horaLlegada:void 0};return p.Z.addAsistente(t),await u(t),await fetch("/api/socket.io",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({event:"nuevo-asistente",data:t})}),o.NextResponse.json(t,{status:201})}catch(e){return o.NextResponse.json({error:"Error creando asistente"},{status:500})}}let g=new a.AppRouteRouteModule({definition:{kind:i.x.APP_ROUTE,page:"/api/asistentes/route",pathname:"/api/asistentes",filename:"route",bundlePath:"app/api/asistentes/route"},resolvedPagePath:"C:\\Users\\Argenis\\OneDrive - Universidad Nacional de Colombia\\Escritorio\\Proyecto Registros\\src\\app\\api\\asistentes\\route.ts",nextConfigOutput:"standalone",userland:r}),{requestAsyncStorage:E,staticGenerationAsyncStorage:m,serverHooks:A}=g,I="/api/asistentes/route";function f(){return(0,n.patchFetch)({serverHooks:A,staticGenerationAsyncStorage:m})}},38990:(e,s,t)=>{t.d(s,{Z:()=>a});class r{getAsistentes(){return this.asistentes}addAsistente(e){this.asistentes.push(e)}findAsistenteById(e){return this.asistentes.find(s=>s.id===e)}updateAsistente(e,s){let t=this.asistentes.findIndex(s=>s.id===e);return -1===t?null:(this.asistentes[t]={...this.asistentes[t],...s},this.asistentes[t])}deleteAsistente(e){let s=this.asistentes.findIndex(s=>s.id===e);return -1!==s&&(this.asistentes.splice(s,1),!0)}searchAsistentes(e){let s=e.toLowerCase();return this.asistentes.filter(e=>e.nombre.toLowerCase().includes(s)||e.email&&e.email.toLowerCase().includes(s)||e.cargo&&e.cargo.toLowerCase().includes(s)||e.empresa&&e.empresa.toLowerCase().includes(s))}getEstadisticas(){let e=this.asistentes.length,s=this.asistentes.filter(e=>e.presente).length;return{total:e,presentes:s,pendientes:e-s,escarapelasImpresas:this.asistentes.filter(e=>e.escarapelaImpresa).length}}constructor(){this.asistentes=[]}}let a=new r},15526:(e,s,t)=>{t.d(s,{Z:()=>n});let r=require("googleapis");var a=t(33064);class i{constructor(){this.sheets=null,this.spreadsheetId=process.env.GOOGLE_SHEETS_SPREADSHEET_ID||"",this.auth=new a.eE({credentials:{client_email:process.env.GOOGLE_SERVICE_ACCOUNT_EMAIL,private_key:process.env.GOOGLE_PRIVATE_KEY?.replace(/\\n/g,"\n")},scopes:["https://www.googleapis.com/auth/spreadsheets"]})}async initializeSheets(){if(!this.sheets){let e=await this.auth.getClient();this.sheets=r.google.sheets({version:"v4",auth:e})}return this.sheets}async getAsistentes(){try{if(!this.spreadsheetId)return console.warn("GOOGLE_SHEETS_SPREADSHEET_ID no configurado"),[];let e=await this.initializeSheets();return((await e.spreadsheets.values.get({spreadsheetId:this.spreadsheetId,range:"Asistentes!A2:J"})).data.values||[]).map((e,s)=>({id:e[0]||`generated-${s}`,nombre:e[1]||"",email:e[2]||"",cargo:e[3]||"",empresa:e[4]||"",presente:"TRUE"===e[5]||"true"===e[5],escarapelaImpresa:"TRUE"===e[6]||"true"===e[6],fechaRegistro:e[7]||new Date().toISOString(),horaLlegada:e[8]||void 0,fechaImpresion:e[9]||void 0}))}catch(e){return console.error("Error leyendo Google Sheets:",e),[]}}async addAsistente(e){try{if(!this.spreadsheetId)return console.warn("GOOGLE_SHEETS_SPREADSHEET_ID no configurado"),!1;let s=await this.initializeSheets();await this.ensureSheetExists();let t=[[e.id,e.nombre,e.email||"",e.cargo||"",e.empresa||"",e.presente,e.escarapelaImpresa,e.fechaRegistro,e.horaLlegada||"",e.fechaImpresion||""]];return await s.spreadsheets.values.append({spreadsheetId:this.spreadsheetId,range:"Asistentes!A2:J",valueInputOption:"RAW",requestBody:{values:t}}),!0}catch(e){return console.error("Error agregando asistente a Google Sheets:",e),!1}}async updateAsistente(e){try{if(!this.spreadsheetId)return console.warn("GOOGLE_SHEETS_SPREADSHEET_ID no configurado"),!1;let s=await this.initializeSheets(),t=((await s.spreadsheets.values.get({spreadsheetId:this.spreadsheetId,range:"Asistentes!A2:J"})).data.values||[]).findIndex(s=>s[0]===e.id);if(-1===t)return console.error("Asistente no encontrado en Google Sheets"),!1;let r=`Asistentes!A${t+2}:J${t+2}`,a=[[e.id,e.nombre,e.email||"",e.cargo||"",e.empresa||"",e.presente,e.escarapelaImpresa,e.fechaRegistro,e.horaLlegada||"",e.fechaImpresion||""]];return await s.spreadsheets.values.update({spreadsheetId:this.spreadsheetId,range:r,valueInputOption:"RAW",requestBody:{values:a}}),!0}catch(e){return console.error("Error actualizando asistente en Google Sheets:",e),!1}}async findAsistenteById(e){try{return(await this.getAsistentes()).find(s=>s.id===e)||null}catch(e){return console.error("Error buscando asistente en Google Sheets:",e),null}}async ensureSheetExists(){try{let e=await this.initializeSheets(),s=await e.spreadsheets.get({spreadsheetId:this.spreadsheetId});s.data.sheets?.find(e=>e.properties?.title==="Asistentes")||(await e.spreadsheets.batchUpdate({spreadsheetId:this.spreadsheetId,requestBody:{requests:[{addSheet:{properties:{title:"Asistentes"}}}]}}),await e.spreadsheets.values.update({spreadsheetId:this.spreadsheetId,range:"Asistentes!A1:J1",valueInputOption:"RAW",requestBody:{values:[["ID","Nombre","Email","Cargo","Empresa","Presente","Escarapela Impresa","Fecha Registro","Hora Llegada","Fecha Impresi\xf3n"]]}}))}catch(e){console.error("Error asegurando que la hoja existe:",e)}}async syncWithMemoryDatabase(e){try{let s=await this.getAsistentes(),t=new Map;return s.forEach(e=>{t.set(e.id,e)}),e.forEach(e=>{let s=t.get(e.id);(!s||new Date(e.fechaRegistro)>=new Date(s.fechaRegistro))&&(t.set(e.id,e),this.updateAsistente(e).catch(console.error))}),Array.from(t.values())}catch(s){return console.error("Error sincronizando con Google Sheets:",s),e}}isConfigured(){return!!(this.spreadsheetId&&process.env.GOOGLE_SERVICE_ACCOUNT_EMAIL&&process.env.GOOGLE_PRIVATE_KEY)}}let n=new i}};var s=require("../../../webpack-runtime.js");s.C(e);var t=e=>s(s.s=e),r=s.X(0,[948,972,64],()=>t(50632));module.exports=r})();