"use strict";(()=>{var e={};e.id=57,e.ids=[57],e.modules={20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},27790:e=>{e.exports=require("assert")},78893:e=>{e.exports=require("buffer")},61282:e=>{e.exports=require("child_process")},84770:e=>{e.exports=require("crypto")},17702:e=>{e.exports=require("events")},92048:e=>{e.exports=require("fs")},32615:e=>{e.exports=require("http")},35240:e=>{e.exports=require("https")},98216:e=>{e.exports=require("net")},19801:e=>{e.exports=require("os")},55315:e=>{e.exports=require("path")},68621:e=>{e.exports=require("punycode")},86624:e=>{e.exports=require("querystring")},76162:e=>{e.exports=require("stream")},82452:e=>{e.exports=require("tls")},74175:e=>{e.exports=require("tty")},17360:e=>{e.exports=require("url")},21764:e=>{e.exports=require("util")},71568:e=>{e.exports=require("zlib")},15673:e=>{e.exports=require("node:events")},97742:e=>{e.exports=require("node:process")},47261:e=>{e.exports=require("node:util")},38676:(e,t,s)=>{s.r(t),s.d(t,{originalPathname:()=>E,patchFetch:()=>f,requestAsyncStorage:()=>c,routeModule:()=>u,serverHooks:()=>g,staticGenerationAsyncStorage:()=>m});var r={};s.r(r),s.d(r,{POST:()=>h});var a=s(49303),i=s(88716),o=s(60670),n=s(87070),d=s(56573),p=s(38990),l=s(15526);async function h(e){try{let{asistentes:t}=await e.json();if(!t||!Array.isArray(t))return n.NextResponse.json({error:"Lista de asistentes requerida"},{status:400});let s={exitosos:0,errores:0,duplicados:0,detalles:[]},r=p.Z.getAsistentes(),a=[];for(let e=0;e<t.length;e++){let i=t[e];try{if(!i.nombre||""===i.nombre.trim()){s.errores++,s.detalles.push(`L\xednea ${e+2}: Nombre requerido`);continue}let t=i.nombre.trim().toLowerCase(),o=i.email?.trim().toLowerCase(),n=r.some(e=>e.nombre.toLowerCase()===t||o&&e.email?.toLowerCase()===o),l=a.some(e=>e.nombre.toLowerCase()===t||o&&e.email?.toLowerCase()===o);if(n||l){s.duplicados++,s.detalles.push(`L\xednea ${e+2}: ${i.nombre} ya existe (duplicado)`);continue}if(i.email&&""!==i.email.trim()&&!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(i.email.trim())){s.errores++,s.detalles.push(`L\xednea ${e+2}: Email inv\xe1lido (${i.email})`);continue}let h={id:(0,d.Z)(),nombre:i.nombre.trim(),email:i.email?.trim()||"",cargo:i.cargo?.trim()||"",empresa:i.empresa?.trim()||"",presente:!1,escarapelaImpresa:!1,fechaRegistro:new Date().toISOString(),horaLlegada:void 0};p.Z.addAsistente(h),a.push(h),s.exitosos++,s.detalles.push(`L\xednea ${e+2}: ${h.nombre} importado exitosamente`)}catch(t){s.errores++,s.detalles.push(`L\xednea ${e+2}: Error procesando ${i.nombre}`)}}if(l.Z.isConfigured()&&a.length>0)try{for(let e of a)await l.Z.addAsistente(e);s.detalles.push(`${a.length} asistentes sincronizados con Google Sheets`)}catch(e){s.detalles.push("Advertencia: Error sincronizando con Google Sheets"),console.error("Error sincronizando con Google Sheets:",e)}if(a.length>0)try{await fetch(`${e.nextUrl.origin}/api/socket.io`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({event:"importacion-masiva",data:{cantidad:a.length,asistentes:a}})})}catch(e){console.error("Error notificando importaci\xf3n masiva:",e)}return n.NextResponse.json(s,{status:200})}catch(e){return console.error("Error importando asistentes:",e),n.NextResponse.json({error:"Error interno del servidor"},{status:500})}}let u=new a.AppRouteRouteModule({definition:{kind:i.x.APP_ROUTE,page:"/api/asistentes/importar/route",pathname:"/api/asistentes/importar",filename:"route",bundlePath:"app/api/asistentes/importar/route"},resolvedPagePath:"C:\\Users\\Argenis\\OneDrive - Universidad Nacional de Colombia\\Escritorio\\Proyecto Registros\\src\\app\\api\\asistentes\\importar\\route.ts",nextConfigOutput:"standalone",userland:r}),{requestAsyncStorage:c,staticGenerationAsyncStorage:m,serverHooks:g}=u,E="/api/asistentes/importar/route";function f(){return(0,o.patchFetch)({serverHooks:g,staticGenerationAsyncStorage:m})}},38990:(e,t,s)=>{s.d(t,{Z:()=>a});class r{getAsistentes(){return this.asistentes}addAsistente(e){this.asistentes.push(e)}findAsistenteById(e){return this.asistentes.find(t=>t.id===e)}updateAsistente(e,t){let s=this.asistentes.findIndex(t=>t.id===e);return -1===s?null:(this.asistentes[s]={...this.asistentes[s],...t},this.asistentes[s])}deleteAsistente(e){let t=this.asistentes.findIndex(t=>t.id===e);return -1!==t&&(this.asistentes.splice(t,1),!0)}searchAsistentes(e){let t=e.toLowerCase();return this.asistentes.filter(e=>e.nombre.toLowerCase().includes(t)||e.email&&e.email.toLowerCase().includes(t)||e.cargo&&e.cargo.toLowerCase().includes(t)||e.empresa&&e.empresa.toLowerCase().includes(t))}getEstadisticas(){let e=this.asistentes.length,t=this.asistentes.filter(e=>e.presente).length;return{total:e,presentes:t,pendientes:e-t,escarapelasImpresas:this.asistentes.filter(e=>e.escarapelaImpresa).length}}constructor(){this.asistentes=[]}}let a=new r},15526:(e,t,s)=>{s.d(t,{Z:()=>o});let r=require("googleapis");var a=s(33064);class i{constructor(){this.sheets=null,this.spreadsheetId=process.env.GOOGLE_SHEETS_SPREADSHEET_ID||"",this.auth=new a.eE({credentials:{client_email:process.env.GOOGLE_SERVICE_ACCOUNT_EMAIL,private_key:process.env.GOOGLE_PRIVATE_KEY?.replace(/\\n/g,"\n")},scopes:["https://www.googleapis.com/auth/spreadsheets"]})}async initializeSheets(){if(!this.sheets){let e=await this.auth.getClient();this.sheets=r.google.sheets({version:"v4",auth:e})}return this.sheets}async getAsistentes(){try{if(!this.spreadsheetId)return console.warn("GOOGLE_SHEETS_SPREADSHEET_ID no configurado"),[];let e=await this.initializeSheets();return((await e.spreadsheets.values.get({spreadsheetId:this.spreadsheetId,range:"Asistentes!A2:J"})).data.values||[]).map((e,t)=>({id:e[0]||`generated-${t}`,nombre:e[1]||"",email:e[2]||"",cargo:e[3]||"",empresa:e[4]||"",presente:"TRUE"===e[5]||"true"===e[5],escarapelaImpresa:"TRUE"===e[6]||"true"===e[6],fechaRegistro:e[7]||new Date().toISOString(),horaLlegada:e[8]||void 0,fechaImpresion:e[9]||void 0}))}catch(e){return console.error("Error leyendo Google Sheets:",e),[]}}async addAsistente(e){try{if(!this.spreadsheetId)return console.warn("GOOGLE_SHEETS_SPREADSHEET_ID no configurado"),!1;let t=await this.initializeSheets();await this.ensureSheetExists();let s=[[e.id,e.nombre,e.email||"",e.cargo||"",e.empresa||"",e.presente,e.escarapelaImpresa,e.fechaRegistro,e.horaLlegada||"",e.fechaImpresion||""]];return await t.spreadsheets.values.append({spreadsheetId:this.spreadsheetId,range:"Asistentes!A2:J",valueInputOption:"RAW",requestBody:{values:s}}),!0}catch(e){return console.error("Error agregando asistente a Google Sheets:",e),!1}}async updateAsistente(e){try{if(!this.spreadsheetId)return console.warn("GOOGLE_SHEETS_SPREADSHEET_ID no configurado"),!1;let t=await this.initializeSheets(),s=((await t.spreadsheets.values.get({spreadsheetId:this.spreadsheetId,range:"Asistentes!A2:J"})).data.values||[]).findIndex(t=>t[0]===e.id);if(-1===s)return console.error("Asistente no encontrado en Google Sheets"),!1;let r=`Asistentes!A${s+2}:J${s+2}`,a=[[e.id,e.nombre,e.email||"",e.cargo||"",e.empresa||"",e.presente,e.escarapelaImpresa,e.fechaRegistro,e.horaLlegada||"",e.fechaImpresion||""]];return await t.spreadsheets.values.update({spreadsheetId:this.spreadsheetId,range:r,valueInputOption:"RAW",requestBody:{values:a}}),!0}catch(e){return console.error("Error actualizando asistente en Google Sheets:",e),!1}}async findAsistenteById(e){try{return(await this.getAsistentes()).find(t=>t.id===e)||null}catch(e){return console.error("Error buscando asistente en Google Sheets:",e),null}}async ensureSheetExists(){try{let e=await this.initializeSheets(),t=await e.spreadsheets.get({spreadsheetId:this.spreadsheetId});t.data.sheets?.find(e=>e.properties?.title==="Asistentes")||(await e.spreadsheets.batchUpdate({spreadsheetId:this.spreadsheetId,requestBody:{requests:[{addSheet:{properties:{title:"Asistentes"}}}]}}),await e.spreadsheets.values.update({spreadsheetId:this.spreadsheetId,range:"Asistentes!A1:J1",valueInputOption:"RAW",requestBody:{values:[["ID","Nombre","Email","Cargo","Empresa","Presente","Escarapela Impresa","Fecha Registro","Hora Llegada","Fecha Impresi\xf3n"]]}}))}catch(e){console.error("Error asegurando que la hoja existe:",e)}}async syncWithMemoryDatabase(e){try{let t=await this.getAsistentes(),s=new Map;return t.forEach(e=>{s.set(e.id,e)}),e.forEach(e=>{let t=s.get(e.id);(!t||new Date(e.fechaRegistro)>=new Date(t.fechaRegistro))&&(s.set(e.id,e),this.updateAsistente(e).catch(console.error))}),Array.from(s.values())}catch(t){return console.error("Error sincronizando con Google Sheets:",t),e}}isConfigured(){return!!(this.spreadsheetId&&process.env.GOOGLE_SERVICE_ACCOUNT_EMAIL&&process.env.GOOGLE_PRIVATE_KEY)}}let o=new i}};var t=require("../../../../webpack-runtime.js");t.C(e);var s=e=>t(t.s=e),r=t.X(0,[948,972,64],()=>s(38676));module.exports=r})();