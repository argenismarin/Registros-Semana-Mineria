"use strict";(()=>{var e={};e.id=253,e.ids=[253],e.modules={20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},27790:e=>{e.exports=require("assert")},78893:e=>{e.exports=require("buffer")},61282:e=>{e.exports=require("child_process")},84770:e=>{e.exports=require("crypto")},17702:e=>{e.exports=require("events")},92048:e=>{e.exports=require("fs")},32615:e=>{e.exports=require("http")},35240:e=>{e.exports=require("https")},98216:e=>{e.exports=require("net")},19801:e=>{e.exports=require("os")},55315:e=>{e.exports=require("path")},68621:e=>{e.exports=require("punycode")},86624:e=>{e.exports=require("querystring")},76162:e=>{e.exports=require("stream")},82452:e=>{e.exports=require("tls")},74175:e=>{e.exports=require("tty")},17360:e=>{e.exports=require("url")},21764:e=>{e.exports=require("util")},71568:e=>{e.exports=require("zlib")},15673:e=>{e.exports=require("node:events")},97742:e=>{e.exports=require("node:process")},47261:e=>{e.exports=require("node:util")},72325:(e,s,t)=>{t.r(s),t.d(s,{originalPathname:()=>g,patchFetch:()=>E,requestAsyncStorage:()=>h,routeModule:()=>d,serverHooks:()=>l,staticGenerationAsyncStorage:()=>c});var r={};t.r(r),t.d(r,{POST:()=>u});var a=t(49303),o=t(88716),i=t(60670),n=t(87070),p=t(15526);async function u(){try{if(!p.Z.isConfigured())return n.NextResponse.json({success:!1,error:"Google Sheets no est\xe1 configurado"});let e=await p.Z.getAsistentes();return n.NextResponse.json({success:!0,message:`Conexi\xf3n exitosa. Se encontraron ${e.length} asistentes.`,asistenteCount:e.length})}catch(s){console.error("Error probando Google Sheets:",s);let e="Error desconocido";return s instanceof Error&&(e=s.message),n.NextResponse.json({success:!1,error:e})}}let d=new a.AppRouteRouteModule({definition:{kind:o.x.APP_ROUTE,page:"/api/configuracion/test-sheets/route",pathname:"/api/configuracion/test-sheets",filename:"route",bundlePath:"app/api/configuracion/test-sheets/route"},resolvedPagePath:"C:\\Users\\Argenis\\OneDrive - Universidad Nacional de Colombia\\Escritorio\\Proyecto Registros\\src\\app\\api\\configuracion\\test-sheets\\route.ts",nextConfigOutput:"standalone",userland:r}),{requestAsyncStorage:h,staticGenerationAsyncStorage:c,serverHooks:l}=d,g="/api/configuracion/test-sheets/route";function E(){return(0,i.patchFetch)({serverHooks:l,staticGenerationAsyncStorage:c})}},15526:(e,s,t)=>{t.d(s,{Z:()=>i});let r=require("googleapis");var a=t(33064);class o{constructor(){this.sheets=null,this.spreadsheetId=process.env.GOOGLE_SHEETS_SPREADSHEET_ID||"",this.auth=new a.eE({credentials:{client_email:process.env.GOOGLE_SERVICE_ACCOUNT_EMAIL,private_key:process.env.GOOGLE_PRIVATE_KEY?.replace(/\\n/g,"\n")},scopes:["https://www.googleapis.com/auth/spreadsheets"]})}async initializeSheets(){if(!this.sheets){let e=await this.auth.getClient();this.sheets=r.google.sheets({version:"v4",auth:e})}return this.sheets}async getAsistentes(){try{if(!this.spreadsheetId)return console.warn("GOOGLE_SHEETS_SPREADSHEET_ID no configurado"),[];let e=await this.initializeSheets();return((await e.spreadsheets.values.get({spreadsheetId:this.spreadsheetId,range:"Asistentes!A2:J"})).data.values||[]).map((e,s)=>({id:e[0]||`generated-${s}`,nombre:e[1]||"",email:e[2]||"",cargo:e[3]||"",empresa:e[4]||"",presente:"TRUE"===e[5]||"true"===e[5],escarapelaImpresa:"TRUE"===e[6]||"true"===e[6],fechaRegistro:e[7]||new Date().toISOString(),horaLlegada:e[8]||void 0,fechaImpresion:e[9]||void 0}))}catch(e){return console.error("Error leyendo Google Sheets:",e),[]}}async addAsistente(e){try{if(!this.spreadsheetId)return console.warn("GOOGLE_SHEETS_SPREADSHEET_ID no configurado"),!1;let s=await this.initializeSheets();await this.ensureSheetExists();let t=[[e.id,e.nombre,e.email||"",e.cargo||"",e.empresa||"",e.presente,e.escarapelaImpresa,e.fechaRegistro,e.horaLlegada||"",e.fechaImpresion||""]];return await s.spreadsheets.values.append({spreadsheetId:this.spreadsheetId,range:"Asistentes!A2:J",valueInputOption:"RAW",requestBody:{values:t}}),!0}catch(e){return console.error("Error agregando asistente a Google Sheets:",e),!1}}async updateAsistente(e){try{if(!this.spreadsheetId)return console.warn("GOOGLE_SHEETS_SPREADSHEET_ID no configurado"),!1;let s=await this.initializeSheets(),t=((await s.spreadsheets.values.get({spreadsheetId:this.spreadsheetId,range:"Asistentes!A2:J"})).data.values||[]).findIndex(s=>s[0]===e.id);if(-1===t)return console.error("Asistente no encontrado en Google Sheets"),!1;let r=`Asistentes!A${t+2}:J${t+2}`,a=[[e.id,e.nombre,e.email||"",e.cargo||"",e.empresa||"",e.presente,e.escarapelaImpresa,e.fechaRegistro,e.horaLlegada||"",e.fechaImpresion||""]];return await s.spreadsheets.values.update({spreadsheetId:this.spreadsheetId,range:r,valueInputOption:"RAW",requestBody:{values:a}}),!0}catch(e){return console.error("Error actualizando asistente en Google Sheets:",e),!1}}async findAsistenteById(e){try{return(await this.getAsistentes()).find(s=>s.id===e)||null}catch(e){return console.error("Error buscando asistente en Google Sheets:",e),null}}async ensureSheetExists(){try{let e=await this.initializeSheets(),s=await e.spreadsheets.get({spreadsheetId:this.spreadsheetId});s.data.sheets?.find(e=>e.properties?.title==="Asistentes")||(await e.spreadsheets.batchUpdate({spreadsheetId:this.spreadsheetId,requestBody:{requests:[{addSheet:{properties:{title:"Asistentes"}}}]}}),await e.spreadsheets.values.update({spreadsheetId:this.spreadsheetId,range:"Asistentes!A1:J1",valueInputOption:"RAW",requestBody:{values:[["ID","Nombre","Email","Cargo","Empresa","Presente","Escarapela Impresa","Fecha Registro","Hora Llegada","Fecha Impresi\xf3n"]]}}))}catch(e){console.error("Error asegurando que la hoja existe:",e)}}async syncWithMemoryDatabase(e){try{let s=await this.getAsistentes(),t=new Map;return s.forEach(e=>{t.set(e.id,e)}),e.forEach(e=>{let s=t.get(e.id);(!s||new Date(e.fechaRegistro)>=new Date(s.fechaRegistro))&&(t.set(e.id,e),this.updateAsistente(e).catch(console.error))}),Array.from(t.values())}catch(s){return console.error("Error sincronizando con Google Sheets:",s),e}}isConfigured(){return!!(this.spreadsheetId&&process.env.GOOGLE_SERVICE_ACCOUNT_EMAIL&&process.env.GOOGLE_PRIVATE_KEY)}}let i=new o}};var s=require("../../../../webpack-runtime.js");s.C(e);var t=e=>s(s.s=e),r=s.X(0,[948,972,64],()=>t(72325));module.exports=r})();